<?xml version="1.0" encoding="utf-8" standalone="no"?>
<Project>
  <PropertyGroup>
    <_ApiDescriptionTasksAssemblyTarget Condition="'$(MSBuildRuntimeType)' == 'Core'">netstandard2.0</_ApiDescriptionTasksAssemblyTarget>
    <_ApiDescriptionTasksAssemblyTarget Condition="'$(MSBuildRuntimeType)' != 'Core'">net461</_ApiDescriptionTasksAssemblyTarget>
    <_ApiDescriptionTasksAssemblyPath>$(MSBuildThisFileDirectory)/../tasks/$(_ApiDescriptionTasksAssemblyTarget)/Microsoft.Extensions.ApiDescription.Client.dll</_ApiDescriptionTasksAssemblyPath>
    <_ApiDescriptionTasksAssemblyTarget />
  </PropertyGroup>
  <UsingTask TaskName="GetCurrentItems" AssemblyFile="$(_ApiDescriptionTasksAssemblyPath)" />
  <UsingTask TaskName="GetFileReferenceMetadata" AssemblyFile="$(_ApiDescriptionTasksAssemblyPath)" />
  <UsingTask TaskName="GetProjectReferenceMetadata" AssemblyFile="$(_ApiDescriptionTasksAssemblyPath)" />
  <UsingTask TaskName="GetUriReferenceMetadata" AssemblyFile="$(_ApiDescriptionTasksAssemblyPath)" />
  <UsingTask TaskName="Microsoft.Extensions.ApiDescription.Client.DownloadFile" AssemblyFile="$(_ApiDescriptionTasksAssemblyPath)" />

  <!-- Settings users may update as they see fit. -->
  <PropertyGroup>
    <ServiceProjectReferenceCheckIfNewer
        Condition="'$(ServiceProjectReferenceCheckIfNewer)' == ''">true</ServiceProjectReferenceCheckIfNewer>
    <ServiceProjectReferenceDirectory
        Condition="'$(ServiceProjectReferenceDirectory)' != ''">$([MSBuild]::EnsureTrailingSlash('$(ServiceProjectReferenceDirectory)'))</ServiceProjectReferenceDirectory>

    <ServiceUriReferenceCheckIfNewer
        Condition="'$(ServiceUriReferenceCheckIfNewer)' == ''">true</ServiceUriReferenceCheckIfNewer>
    <ServiceUriReferenceDirectory
        Condition="'$(ServiceUriReferenceDirectory)' != ''">$([MSBuild]::EnsureTrailingSlash('$(ServiceUriReferenceDirectory)'))</ServiceUriReferenceDirectory>

    <ServiceFileReferenceCheckIfNewer
        Condition="'$(ServiceFileReferenceCheckIfNewer)' == ''">true</ServiceFileReferenceCheckIfNewer>
    <ServiceFileReferenceDirectory
        Condition="'$(ServiceFileReferenceDirectory)' != ''">$([MSBuild]::EnsureTrailingSlash('$(ServiceFileReferenceDirectory)'))</ServiceFileReferenceDirectory>
    <ServiceFileReferenceCSharpNamespace Condition="'$(ServiceFileReferenceCSharpNamespace)' == ''" />
    <ServiceFileReferenceTypeScriptNamespace Condition="'$(ServiceFileReferenceTypeScriptNamespace)' == ''" />

    <DefaultDocumentGeneratorDefaultOptions Condition="'$(DefaultDocumentGeneratorDefaultOptions)' == ''" />
  </PropertyGroup>

  <!--
    Well-known metadata of the code and document generator item groups. ServiceProjectReference and ServiceUriReference
    items may also include ServiceFileReference metadata.
  -->
  <ItemDefinitionGroup>
    <ServiceProjectReference>
      <!--
        Name of the API description document generator.  Builds will invoke a target named
        "%(DocumentGenerator)DocumentGenerator" to do actual document retrieval / generation.
      -->
      <DocumentGenerator>Default</DocumentGenerator>

      <!-- Server project metadata which is likely applicable to all document generators. -->

      <!--
        Full path of the project's generated assembly. Corresponds to $(TargetPath). Because common code builds server
        projects, file exists prior to document generator invocation.
      -->
      <ProjectAssemblyPath />
      <!-- Server project's chosen configuration. Likely matches client project's configuration. -->
      <ProjectConfiguration />
      <!--
        Server project's extensions path. Corresponds to $(MSBuildProjectExtensionsPath). User must set this if
        server project's value is not 'obj/'.
      -->
      <ProjectExtensionsPath />
      <!-- Runtime identifier to use when building the server project. -->
      <ProjectRuntimeIdentifier />
      <!-- Server project's target framework. Defaults to $(TargetFramewok) or first of $(TargetFrameworks). -->
      <ProjectTargetFramework />

      <!-- Metadata specific to the Default document generator (though other document generators are free to use it). -->

      <!--
        Options added to Default document generator tool's command line. Defaults to
        $(DefaultDocumentGeneratorDefaultOptions) if that is set in the client project.
      -->
      <DefaultDocumentGeneratorOptions />
      <!--
        Name of the document to generate. Passed to the %(Method) when using Default document generator. Default is set
        in server project, falling back to "v1".
      -->
      <DocumentName />
      <!--
        Full path where the API description document is placed. Default filename is %(Filename).%(DocumentName).json.
        Filenames and relative paths (if explicitly set) are combined with $(ServiceProjectReferenceDirectory).
      -->
      <DocumentPath />
      <!--
        Method Default document generator should invoke on the %(Service) to generate document.
        Default is set in server project, falling back to "Generate".
      -->
      <Method />
      <!--
        Service Default document generator should retrieve from DI to generate document.
        Default is set in server project, falling back to "Microsoft.Extensions.ApiDescription.IDocumentProvider".
      -->
      <Service />
      <!--
        URI from which Default document generator should download the document. Used only if invoking the %(Method) on
        the %(Service) fails. Default is set in server project and metadata has no further fallback.
      -->
      <Uri />
    </ServiceProjectReference>

    <ServiceUriReference>
      <!--
        Full path where the API description document is placed. Default filename is based on %(Identity).
        Filenames and relative paths (if explicitly set) are combined with $(ServiceUriReferenceDirectory).
      -->
      <DocumentPath />
    </ServiceUriReference>

    <ServiceFileReference>
      <!-- Name of the class to generate. Defaults to %(Filename)Client but with an uppercase first letter. -->
      <ClassName />
      <!--
        Code generator to use. Required and must end with "CSharp" or "TypeScript" (the currently-supported target
        languages). Builds will invoke a target named "%(CodeGenerator)CodeGenerator" to do actual code generation.
      -->
      <CodeGenerator />
      <!--
        Namespace to contain generated class. Default is either $(ServiceFileReferenceCSharpNamespace) or
        $(ServiceFileReferenceTypeScriptNamespace), depending on target language.
      -->
      <Namespace />
      <!--
        Path to place generated code. Code generator may interpret path as a filename or directory. Default filename or
        folder name is %(ClassName).[cs|ts]. Filenames and relative paths (if explicitly set) are combined with
        $(ServiceFileReferenceDirectory).
      -->
      <OutputPath />
      <!-- Language of the generated file. Calculated based on %(CodeGenerator). -->
      <TargetLanguage />
    </ServiceFileReference>
  </ItemDefinitionGroup>
</Project>
